<li class="list-none w-full" data-qid="{{ q.id }}">
  <div class="w-full bg-base-200 rounded-lg border border-base-300 p-3 mb-2">
    <div class="flex items-start gap-3">
      <button type="button" class="drag-handle inline-flex items-center justify-center w-7 h-7 mr-1 rounded-md text-primary border border-primary/30 hover:bg-primary/20 shrink-0 cursor-move" style="background-color: color-mix(in oklch, var(--p) 12%, transparent);" aria-label="Drag to reorder" title="Drag to reorder">
        <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" viewBox="0 0 48 48" fill="currentColor" aria-hidden="true" focusable="false">
            <title>drag-arrow</title>
            <g id="Layer_2" data-name="Layer 2">
                <g id="invisible_box" data-name="invisible box">
                <rect width="48" height="48" fill="none"/>
                </g>
                <g id="icons_Q2" data-name="icons Q2">
                <path d="M45.4,22.6l-5.9-6a2.1,2.1,0,0,0-2.7-.2,1.9,1.9,0,0,0-.2,3L39.2,22H26V8.8l2.6,2.6a1.9,1.9,0,0,0,3-.2,2.1,2.1,0,0,0-.2-2.7l-6-5.9a1.9,1.9,0,0,0-2.8,0l-6,5.9a2.1,2.1,0,0,0-.2,2.7,1.9,1.9,0,0,0,3,.2L22,8.8V22H8.8l2.6-2.6a1.9,1.9,0,0,0-.2-3,2.1,2.1,0,0,0-2.7.2l-5.9,6a1.9,1.9,0,0,0,0,2.8l5.9,6a2.1,2.1,0,0,0,2.7.2,1.9,1.9,0,0,0,.2-3L8.8,26H22V39.2l-2.6-2.6a1.9,1.9,0,0,0-3,.2,2.1,2.1,0,0,0,.2,2.7l6,5.9a1.9,1.9,0,0,0,2.8,0l6-5.9a2.1,2.1,0,0,0,.2-2.7,1.9,1.9,0,0,0-3-.2L26,39.2V26H39.2l-2.6,2.6a1.9,1.9,0,0,0,.2,3,2.1,2.1,0,0,0,2.7-.2l5.9-6A1.9,1.9,0,0,0,45.4,22.6Z"/>
                </g>
            </g>
            </svg>
      </button>
      <div class="grow">
        <div class="flex items-baseline gap-2 w-full">
          <div class="grow">
            <div class="font-medium">
              <span class="q-number text-sm opacity-70 mr-2 select-none">{{ forloop.counter }}</span>
              {{ q.text }}
            </div>
            <div class="text-xs opacity-70">{{ q.get_type_display }}{% if q.group %} • Group: {{ q.group.name }}{% endif %}{% if q.required %} • required{% endif %}</div>
            {% include 'surveys/partials/question_preview.html' %}
          </div>
          {% comment %} <div class="flex gap-2 ml-auto pr-1"> {% endcomment %}
            <form method="post" hx-post="{% if group %}/surveys/{{ q.survey.slug }}/builder/groups/{{ group.id }}/questions/{{ q.id }}/delete{% else %}/surveys/{{ q.survey.slug }}/builder/questions/{{ q.id }}/delete{% endif %}" hx-target="#questions-list" hx-swap="outerHTML" hx-confirm="Delete this question?">
              {% csrf_token %}
              <button type="submit" class="btn btn-xs btn-warning">Delete</button>
            </form>
          {% comment %} </div> {% endcomment %}
        </div>
        <details class="mt-3">
          <summary class="cursor-pointer select-none">Edit</summary>
          <form class="mt-3" hx-post="{% if group %}/surveys/{{ q.survey.slug }}/builder/groups/{{ group.id }}/questions/{{ q.id }}/edit{% else %}/surveys/{{ q.survey.slug }}/builder/questions/{{ q.id }}/edit{% endif %}" hx-target="closest li" hx-swap="outerHTML">
            {% csrf_token %}
            <label class="label">Text</label>
            <input name="text" class="input input-bordered w-full" value="{{ q.text }}" />
            <label class="label mt-2">Type</label>
            <select name="type" class="select select-bordered w-full">
              <option value="text" {% if q.type == 'text' %}selected{% endif %}>Free text</option>
              <option value="mc_single" {% if q.type == 'mc_single' %}selected{% endif %}>Multiple choice (single)</option>
              <option value="mc_multi" {% if q.type == 'mc_multi' %}selected{% endif %}>Multiple choice (multi)</option>
              <option value="likert" {% if q.type == 'likert' %}selected{% endif %}>Likert scale</option>
              <option value="orderable" {% if q.type == 'orderable' %}selected{% endif %}>Orderable list</option>
              <option value="yesno" {% if q.type == 'yesno' %}selected{% endif %}>Yes/No</option>
              <option value="dropdown" {% if q.type == 'dropdown' %}selected{% endif %}>Dropdown</option>
              <option value="image" {% if q.type == 'image' %}selected{% endif %}>Image choice</option>
            </select>
            <label class="label mt-2">Required</label>
            <input type="checkbox" name="required" class="toggle" {% if q.required %}checked{% endif %} />
            <label class="label mt-2">Options (one per line)</label>
            <textarea name="options" class="textarea textarea-bordered w-full">{% for opt in q.options %}{{ opt }}
{% endfor %}</textarea>
            <label class="label mt-2">Group</label>
            <select name="group_id" class="select select-bordered w-full" {% if group %}disabled{% endif %}>
              <option value="">(none)</option>
              {% with selectable_groups=groups|default:q.survey.question_groups.all %}
              {% for g in selectable_groups %}
                <option value="{{ g.id }}" {% if q.group and q.group.id == g.id %}selected{% endif %}>{{ g.name }}</option>
              {% endfor %}
              {% endwith %}
            </select>
            <div class="mt-3">
              <button class="btn btn-primary btn-sm" type="submit">Save</button>
            </div>
          </form>
        </details>
      </div>
    </div>
  </div>
</li>
