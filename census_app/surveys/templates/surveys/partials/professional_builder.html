{% load survey_extras %}
{% if show_professional_details %}
<div id="professional-preview" class="card bg-base-100 shadow mt-4">
  <div class="card-body">
    <h3 class="card-title">Professional details</h3>
    <p class="text-sm opacity-70">These fields are stored in clear (non-encrypted) and can be exported.</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
      {% for key,label in professional_defs.items %}
        {% if key in professional_fields %}
          <div class="space-y-1" data-professional-field="{{ key }}">
            {% if professional_field_datasets|dict_get:key %}
              {# Field has a dataset mapping - use dropdown #}
              <label class="label">
                <span class="label-text">{{ label }}</span>
              </label>
              <select
                class="select select-bordered select-sm w-full"
                name="prof_{{ key }}"
                data-dataset-field="{{ key }}"
                data-dataset-key="{{ professional_field_datasets|dict_get:key }}"
                disabled>
                <option value="">-- Select {{ label }} --</option>
                <option value="__preview__" disabled selected>Options loaded in live form</option>
              </select>
            {% else %}
              {# Regular text input #}
              <label class="input input-bordered input-sm flex items-center gap-1.5">
                <input class="grow min-w-0 bg-transparent outline-none border-0" name="prof_{{ key }}" placeholder="{{ label }}" />
              </label>
            {% endif %}
            {% if professional_ods_on and key in professional_ods_on %}
              <label class="input input-bordered input-sm flex items-center gap-1.5">
                <input class="grow min-w-0 bg-transparent outline-none border-0" name="prof_{{ key }}_ods" placeholder="{{ label }} ODS code" />
              </label>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
    <form class="mt-4" hx-post="/surveys/{{ survey.slug }}/builder/professional/update" hx-target="#professional-preview" hx-swap="outerHTML" hx-trigger="change">
      {% csrf_token %}
      <fieldset>
        <legend class="label">Include these fields</legend>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
          {% for key,label in professional_defs.items %}
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="checkbox" class="checkbox" name="fields" value="{{ key }}" {% if key in professional_fields %}checked{% endif %} />
              <span class="label-text">{{ label }}</span>
            </label>
          {% endfor %}
        </div>
      </fieldset>
      <fieldset class="mt-3">
        <legend class="label">ODS code toggles</legend>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
          {% for pair in professional_ods_pairs %}
            {% if pair.key in professional_fields %}
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" class="checkbox" name="ods_{{ pair.key }}" {% if pair.on %}checked{% endif %} />
                <span class="label-text">{{ pair.label }} â€“ include ODS code</span>
              </label>
            {% endif %}
          {% endfor %}
        </div>
      </fieldset>
    </form>
  </div>
</div>
{% endif %}
