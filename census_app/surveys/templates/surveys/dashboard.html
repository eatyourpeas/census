{% extends 'base.html' %}
{% block head_theme_overrides %}
  {% if survey.style.theme_css_light or survey.style.theme_css_dark %}
  <style>
    {% if survey.style.theme_css_light %}
    [data-theme="census-light"] {
      {{ survey.style.theme_css_light|safe }}
    }
    {% endif %}
    {% if survey.style.theme_css_dark %}
    [data-theme="census-dark"] {
      {{ survey.style.theme_css_dark|safe }}
    }
    {% endif %}
  </style>
  {% endif %}
  {% if survey.style.font_css_url %}
    <link href="{{ survey.style.font_css_url }}" rel="stylesheet" />
  {% endif %}
{% endblock %}
{% block title %}Dashboard - {{ survey.name }}{% endblock %}
{% block content %}
<div class="prose">
  {% include 'components/breadcrumbs.html' with crumb1_label="Surveys" crumb1_href="/surveys/" crumb2_label="Survey Dashboard" crumb2_href="/surveys/"|add:survey.slug|add:"/dashboard/" %}
  <h2>{{ survey.name }}</h2>
  <p>Status: {% if survey.is_live %}Live{% else %}Not live{% endif %}</p>
  <p>Total responses: <strong>{{ total }}</strong></p>
  <div class="flex gap-2">
    <a class="btn btn-primary btn-sm" href="/surveys/{{ survey.slug }}/preview/">Preview (read-only)</a>
    <a class="btn btn-primary btn-sm" href="/surveys/{{ survey.slug }}/groups/">Manage Survey Questions</a>
  </div>
</div>

<div class="mt-6">
  <details class="mb-6">
    <summary class="cursor-pointer select-none text-lg font-semibold">Survey style</summary>
    <form class="mt-3 grid md:grid-cols-2 gap-3" method="post" action="/surveys/{{ survey.slug }}/style/update">
      {% csrf_token %}
      <div>
        <label class="label">Title override</label>
        <input class="input input-bordered w-full" name="title" value="{{ survey.style.title }}" placeholder="Defaults to platform title" />
      </div>
      <div>
        <label class="label">Icon URL</label>
        <input class="input input-bordered w-full" name="icon_url" value="{{ survey.style.icon_url }}" placeholder="/static/favicon.ico or absolute URL" />
      </div>
      <div>
        <label class="label">Theme name</label>
        <input class="input input-bordered w-full" name="theme_name" value="{{ survey.style.theme_name }}" placeholder="e.g. census, light, dark" />
      </div>
      <div>
        <label class="label">Primary color (hex)</label>
        <input class="input input-bordered w-full" name="primary_color" value="{{ survey.style.primary_color }}" placeholder="#fac8cd" />
        <p class="text-xs opacity-70 mt-1">Tip: paste a hex like #ff3366 â€” it will be converted to the correct OKLCH internally.</p>
      </div>
      <div>
        <label class="label">Heading font (CSS stack)</label>
        <input class="input input-bordered w-full" name="font_heading" value="{{ survey.style.font_heading }}" placeholder="'IBM Plex Sans', ui-sans-serif, ..." />
      </div>
      <div>
        <label class="label">Body font (CSS stack)</label>
        <input class="input input-bordered w-full" name="font_body" value="{{ survey.style.font_body }}" placeholder="Merriweather, ui-serif, ..." />
      </div>
      <div class="md:col-span-2">
        <label class="label">Font CSS URL (e.g. Google Fonts)</label>
        <input class="input input-bordered w-full" name="font_css_url" value="{{ survey.style.font_css_url }}" placeholder="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Source+Serif+4:wght@400;700&display=swap" />
      </div>
      <div class="md:col-span-2">
        <button class="btn btn-primary" type="submit">Save style</button>
      </div>
    </form>
  </details>

  {# Intentionally removed group management from dashboard; use Groups page instead #}
</div>
{% endblock %}
