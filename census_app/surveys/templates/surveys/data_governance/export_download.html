{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Download Export" %} - {{ survey.name }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-2xl">
    <nav class="text-sm breadcrumbs mb-4">
        <ul>
            <li><a href="{% url 'surveys:list' %}">{% trans "Surveys" %}</a></li>
            <li><a href="{% url 'surveys:detail' survey.slug %}">{{ survey.name }}</a></li>
            <li><a href="{% url 'surveys:dashboard' survey.slug %}">{% trans "Data Governance" %}</a></li>
            <li>{% trans "Download Export" %}</li>
        </ul>
    </nav>

    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <h1 class="card-title text-2xl">{% trans "Export Ready" %}</h1>
            
            <div class="alert alert-success mt-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <div>
                    <h3 class="font-bold">{% trans "Export Created Successfully" %}</h3>
                    <p class="text-sm">{{ export.response_count }} {% trans "responses exported" %}</p>
                </div>
            </div>

            <div class="divider"></div>

            <div class="space-y-4">
                <div class="stats shadow w-full">
                    <div class="stat">
                        <div class="stat-title">{% trans "Export Details" %}</div>
                        <div class="stat-value text-lg">{{ export.response_count }} {% trans "responses" %}</div>
                        <div class="stat-desc">
                            {% trans "Created" %}: {{ export.created_at|date:"Y-m-d H:i" }}
                        </div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">{% trans "Link Expires" %}</div>
                        <div class="stat-value text-lg">{{ expires_at|timeuntil }}</div>
                        <div class="stat-desc">{{ expires_at|date:"Y-m-d H:i" }}</div>
                    </div>
                </div>

                {% if export.is_password_protected %}
                <div class="alert alert-info">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>
                        {% trans "This export is password-protected. You will need the password you set to open the ZIP file." %}
                    </span>
                </div>
                {% endif %}

                <div class="card bg-base-200">
                    <div class="card-body">
                        <h3 class="font-bold">{% trans "Download Link" %}</h3>
                        <p class="text-sm text-gray-600 mb-4">
                            {% trans "Click the button below to download your export. This link will expire in 7 days." %}
                        </p>
                        
                        <div class="flex gap-2">
                            <input 
                                type="text" 
                                value="{{ download_url }}" 
                                class="input input-bordered flex-1 font-mono text-sm" 
                                readonly
                                id="download-url"
                            />
                            <button 
                                onclick="copyToClipboard()" 
                                class="btn btn-secondary"
                            >
                                {% trans "Copy" %}
                            </button>
                        </div>
                        
                        <a href="{{ download_url }}" class="btn btn-primary btn-lg mt-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            {% trans "Download Export" %}
                        </a>
                    </div>
                </div>

                <div class="alert alert-warning">
                    <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    <div>
                        <h4 class="font-bold">{% trans "Security Reminder" %}</h4>
                        <ul class="list-disc ml-5 text-sm">
                            <li>{% trans "This download link is single-use and time-limited" %}</li>
                            <li>{% trans "All downloads are logged for audit purposes" %}</li>
                            <li>{% trans "Handle exported data according to your data protection policies" %}</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <div class="card-actions justify-end">
                <a href="{% url 'surveys:dashboard' survey.slug %}" class="btn btn-ghost">
                    {% trans "Back to Data Governance" %}
                </a>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard() {
    const input = document.getElementById('download-url');
    input.select();
    input.setSelectionRange(0, 99999); // For mobile devices
    document.execCommand('copy');
    
    // Show toast notification (if you have a toast system)
    alert('{% trans "Link copied to clipboard!" %}');
}
</script>
{% endblock %}
