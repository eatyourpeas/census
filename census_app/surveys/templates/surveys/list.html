{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% block title %}{% trans "Your Surveys" %} - Census{% endblock %}
{% block content %}
<div class="prose max-w-none">
  {% include 'components/breadcrumbs.html' with crumb1_label='Surveys' crumb1_href='/surveys/' %}
  <h1 class="inline-flex items-center gap-2">
    {% include "components/icons/clipboard.html" with classes="w-6 h-6 text-base-content" %}
    <span>{% trans "Your Surveys" %}</span>
  </h1>
  {% if user.is_authenticated %}
    <p><a class="btn btn-primary not-prose" href="/surveys/create/">{% trans "Create survey" %}</a></p>
  {% endif %}
  {% if surveys %}
  <ul class="not-prose w-full flex flex-col gap-3">
      {% for s in surveys %}
        <li class="w-full">
          <div class="w-full bg-base-100 rounded-lg border border-base-300 p-3 sm:p-4 hover:border-primary transition-colors">
            <div class="flex items-center gap-4 min-w-0">
              <div class="flex-shrink-0 inline-flex items-center justify-center">
                {% include "components/icons/census_brand.html" with classes=brand.icon_size_class|default:'w-8 h-8' aria_label=brand.icon_alt|default:brand.title title=brand.icon_title|default:brand.title %}
              </div>
              <div class="min-w-0 w-full">
                <div class="flex items-center gap-2 min-w-0">
                  <div class="font-medium leading-tight truncate">{{ s.name }}</div>
                  <span class="badge badge-primary badge-outline whitespace-nowrap">{{ s.get_status_display|default:s.status }}</span>
                  {% if s.status == 'published' %}
                    {% with days=s.days_remaining %}
                      {% if days is None %}
                        <span class="badge badge-info badge-outline whitespace-nowrap">{% trans "No end date" %}</span>
                      {% elif days < 0 %}
                        <span class="badge badge-error badge-outline whitespace-nowrap">{% trans "Expired" %}</span>
                      {% elif days == 0 %}
                        <span class="badge badge-warning badge-outline whitespace-nowrap">{% trans "Ends today" %}</span>
                      {% elif days == 1 %}
                        <span class="badge badge-warning badge-outline whitespace-nowrap">{% trans "1 day remaining" %}</span>
                      {% elif days <= 7 %}
                        <span class="badge badge-warning badge-outline whitespace-nowrap">{{ days }} {% trans "days remaining" %}</span>
                      {% else %}
                        <span class="badge badge-success badge-outline whitespace-nowrap">{{ days }} {% trans "days remaining" %}</span>
                      {% endif %}
                    {% endwith %}
                  {% endif %}
                </div>
                {% if s.description %}
                  <div class="text-sm opacity-70 truncate">{{ s.description }}</div>
                {% endif %}
              </div>
            </div>
            <div class="-mx-1 overflow-x-auto mt-3">
              <div class="px-1 min-w-max flex items-center gap-2">
                <a class="btn btn-primary btn-sm" href="/surveys/{{ s.slug }}/dashboard/">{% trans "Dashboard" %}</a>
                <a class="btn btn-primary btn-sm" href="/surveys/{{ s.slug }}/groups/">{% trans "Groups" %}</a>
                <a class="btn btn-primary btn-sm" href="/surveys/{{ s.slug }}/preview/">{% trans "Preview" %}</a>
                <a class="btn btn-primary btn-sm" href="/surveys/{{ s.slug }}/bulk-upload/">{% trans "Import" %}</a>
              </div>
            </div>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>{% trans "No surveys yet." %}</p>
  {% endif %}
</div>
{% endblock %}
