{% extends 'base.html' %}
{% block title %}API Explorer{% endblock %}
{% block content %}
<div class="prose">
  <h1>API Explorer</h1>
  <p>Interactive OpenAPI explorer for the Census API. Authentication required for private endpoints.</p>
</div>

<!-- Minimal Swagger UI Embed (served from unpkg CDN); CSP exempted in view -->
<link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@5.17.14/swagger-ui.css" />
<div id="swagger" class="mt-4"></div>
<script src="https://unpkg.com/swagger-ui-dist@5.17.14/swagger-ui-bundle.js" crossorigin="anonymous"></script>
<script>
  window.ui = SwaggerUIBundle({
    url: "/api/schema",
    dom_id: "#swagger",
    presets: [SwaggerUIBundle.presets.apis, SwaggerUIBundle.SwaggerUIStandalonePreset],
    layout: "BaseLayout",
    requestInterceptor: (req) => {
      // Auto-attach JWT from localStorage if present
      const token = localStorage.getItem('jwt');
      if (token) {
        req.headers['Authorization'] = `Bearer ${token}`;
      }
      return req;
    },
  });
</script>
{% endblock %}
