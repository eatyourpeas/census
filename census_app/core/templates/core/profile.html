{% extends 'base.html' %}
{% block title %}Profile - Census{% endblock %}
{% block content %}
<div class="prose">
  <h1>Your Profile</h1>
  <p>Signed in as <strong>{{ request.user.username }}</strong></p>
</div>

<div class="mt-6 max-w-2xl">
  <div class="card bg-base-100 shadow mb-6">
    <div class="card-body">
      <h2 class="card-title">Appearance</h2>
      <p class="opacity-80">Choose your theme. This only affects your view and is saved in your browser.</p>
      <div class="form-control">
        <label class="label" for="theme-select"><span class="label-text">Theme</span></label>
        <select id="theme-select" class="select select-bordered w-full max-w-xs">
          <option value="system">System</option>
          <option value="census-light">Light</option>
          <option value="census-dark">Dark</option>
        </select>
        <noscript>
          <div class="alert alert-warning mt-3">Enable JavaScript to change theme.</div>
        </noscript>
      </div>
    </div>
  </div>

  {% if request.user.is_superuser %}
  <div class="card bg-base-100 shadow mb-6">
    <div class="card-body">
      <h2 class="card-title">Project theme and brand (admins)</h2>
      <p class="opacity-80">Paste DaisyUI Builder output (light and dark) to reskin the whole app. Fonts and icon apply globally.</p>
      <div class="flex items-center gap-3 mb-3 flex-wrap">
        <div class="flex items-center gap-2">
          <span class="opacity-70">Current icon (light/default):</span>
          {% if brand.icon_url %}
            <img src="{{ brand.icon_url }}" alt="Current light icon" class="w-8 h-8 rounded" />
          {% else %}
            <span class="opacity-60">(fallback icon in use)</span>
          {% endif %}
        </div>
        <div class="flex items-center gap-2">
          <span class="opacity-70">Current icon (dark):</span>
          {% if brand.icon_url_dark %}
            <img src="{{ brand.icon_url_dark }}" alt="Current dark icon" class="w-8 h-8 rounded" />
          {% else %}
            <span class="opacity-60">(using light/fallback)</span>
          {% endif %}
        </div>
      </div>
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="action" value="update_branding" />
        <div class="grid md:grid-cols-2 gap-3">
          <label class="form-control">
            <span class="label"><span class="label-text">Default theme</span></span>
            <select class="select select-bordered" name="default_theme">
              <option value="census-light" {% if brand.theme_name == 'census-light' %}selected{% endif %}>Census Light</option>
              <option value="census-dark" {% if brand.theme_name == 'census-dark' %}selected{% endif %}>Census Dark</option>
            </select>
          </label>
          <label class="form-control">
            <span class="label"><span class="label-text">Icon URL (optional)</span></span>
            <input class="input input-bordered" name="icon_url" value="{{ sb.icon_url|default:'' }}" placeholder="https://... (overrides uploaded icon)" />
          </label>
          <label class="form-control">
            <span class="label"><span class="label-text">Upload icon (SVG or PNG, optional)</span></span>
            <input type="file" class="file-input file-input-bordered" name="icon_file" accept="image/svg+xml,image/png" />
          </label>
          <label class="form-control">
            <span class="label"><span class="label-text">Dark icon URL (optional)</span></span>
            <input class="input input-bordered" name="icon_url_dark" value="{{ sb.icon_url_dark|default:'' }}" placeholder="https://... (shown when dark theme active)" />
          </label>
          <label class="form-control">
            <span class="label"><span class="label-text">Upload dark icon (SVG or PNG, optional)</span></span>
            <input type="file" class="file-input file-input-bordered" name="icon_file_dark" accept="image/svg+xml,image/png" />
          </label>
          <label class="form-control">
            <span class="label"><span class="label-text">Heading font (CSS stack)</span></span>
            <input class="input input-bordered" name="font_heading" value="{{ brand.font_heading }}" placeholder="'Inter', ui-sans-serif, system-ui, ..." />
          </label>
          <label class="form-control">
            <span class="label"><span class="label-text">Body font (CSS stack)</span></span>
            <input class="input input-bordered" name="font_body" value="{{ brand.font_body }}" placeholder="Merriweather, ui-serif, Georgia, ..." />
          </label>
          <label class="form-control md:col-span-2">
            <span class="label"><span class="label-text">Font CSS URL (e.g. Google Fonts)</span></span>
            <input class="input input-bordered w-full" name="font_css_url" value="{{ brand.font_css_url }}" placeholder="https://fonts.googleapis.com/css2?..." />
          </label>
          <label class="form-control md:col-span-2">
            <span class="label"><span class="label-text">Theme CSS (light) — paste variables from DaisyUI Builder</span></span>
            <textarea class="textarea textarea-bordered h-36" name="theme_light_css" placeholder="--color-base-100: ...;\n--color-primary: ...;">{{ brand.theme_css_light }}</textarea>
          </label>
          <label class="form-control md:col-span-2">
            <span class="label"><span class="label-text">Theme CSS (dark) — optional</span></span>
            <textarea class="textarea textarea-bordered h-36" name="theme_dark_css" placeholder="--color-base-100: ...;\n--color-primary: ...;">{{ brand.theme_css_dark }}</textarea>
          </label>
        </div>
        <div class="mt-3"><button type="submit" class="btn btn-primary">Save project theme</button></div>
      </form>
    </div>
  </div>
  {% endif %}
  {% if not can_manage_any_users %}
    <div class="card bg-base-100 shadow">
      <div class="card-body">
        <h2 class="card-title">Upgrade to organisation</h2>
        <p class="opacity-80">Upgrading creates an organisation that you administer. You’ll be able to host surveys and build a team. Simple users cannot gain permissions inside someone else’s organisation, but you can create your own organisation at any time.</p>
        <form method="post" class="space-y-3">
          {% csrf_token %}
          <input type="hidden" name="action" value="upgrade_to_org" />
          <label class="form-control">
            <span class="label"><span class="label-text">Organisation name (optional)</span></span>
            <input type="text" name="org_name" class="input input-bordered w-full" placeholder="e.g. Acme Health" />
          </label>
          <button type="submit" class="btn btn-primary">Create organisation</button>
        </form>
      </div>
    </div>
  {% else %}
    <div class="alert alert-info">You already have user management permissions.</div>
  {% endif %}
</div>
{% endblock %}
